"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_excluded=["condition"];function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){(0,_defineProperty2.default)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _createForOfIteratorHelper(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==t.return||t.return()}finally{if(c)throw a}}}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var _require=require("./lite-enum"),SPECIAL_STYLE=_require.SPECIAL_STYLE,REGEXP_NUMBER_PX=_require.REGEXP_NUMBER_PX,REGEXP_COLOR=_require.REGEXP_COLOR,REGEXP_UNIT=_require.REGEXP_UNIT,REGXP_QUOTES=_require.REGXP_QUOTES;function transformStyle(e){for(var r=Function("return ".concat(e))(),t={},n={},o={},a=Object.keys(r),i=0,c=a;i<c.length;i++){var u=c[i];"."===u.charAt(0)?n[u.slice(1)]=styleFormat(r[u]):"#"===u.charAt(0)?t[u.slice(1)]=styleFormat(r[u]):"@KEYFRAMES"===u?o["@keyframes"]=keyFrameFormat(r[u]):"@MEDIA"===u&&(o["@media"]=mediaQueryFormat(r[u]))}return null!=r&&0!==a.length&&(0!==Object.keys(t).length&&(o.idSelectors=t),0!==Object.keys(n).length&&(o.classSelectors=n)),JSON.stringify(o)}function keyFrameFormat(e){for(var r=0,t=Object.keys(e);r<t.length;r++){var n,o=_createForOfIteratorHelper(e[t[r]]);try{for(o.s();!(n=o.n()).done;)for(var a=n.value,i=0,c=Object.keys(a);i<c.length;i++){var u=c[i],f=a[u];REGEXP_COLOR.test(f)&&(a[u]=parseInt(f.slice(1),16));try{a[u]=JSON.parse(a[u])}catch(e){}}}catch(e){o.e(e)}finally{o.f()}}return e}function mediaQueryFormat(e){var r,t=[],n=_createForOfIteratorHelper(e);try{for(n.s();!(r=n.n()).done;){var o=r.value,a=o.condition,i=(0,_objectWithoutProperties2.default)(o,_excluded),c=transformStyle(JSON.stringify(i));c&&(c=JSON.parse(c),t.push(_objectSpread({condition:a},c)))}}catch(e){n.e(e)}finally{n.f()}return t}var rules=[{match:function(e,r){return e===SPECIAL_STYLE.ANIMATION_DELAY||e===SPECIAL_STYLE.ANIMATION_DURATION},action:function(e,r,t){e[r]=t}},{match:function(e,r){return e===SPECIAL_STYLE.ANIMATION_ITERATION_COUNT},action:function(e,r,t){-1===t&&(t="infinite"),e[r]=t.toString()}},{match:function(e,r){return[SPECIAL_STYLE.BACKGROUND_IMAGE,SPECIAL_STYLE.BACKGROUND_IMAGE_ACTIVE,SPECIAL_STYLE.BACKGROUND_IMAGE_CHECKED].includes(e)},action:function(e,r,t){e[r]=t.replace(REGXP_QUOTES,"")}},{match:function(e,r){return!isNaN(Number(r))},action:function(e,r,t){e[r]=Number(t)}},{match:function(e,r){return REGEXP_NUMBER_PX.test(r)},action:function(e,r,t){e[r]=parseInt(t.replace(REGEXP_UNIT,""),10)}},{match:function(e,r){return REGEXP_COLOR.test(r)},action:function(e,r,t){e[r]=parseInt(t.slice(1),16)}},{match:function(e,r){return"true"===r},action:function(e,r,t){e[r]=!0}},{match:function(e,r){return"false"===r},action:function(e,r,t){e[r]=!1}}];function styleFormat(e){for(var r="",t=0,n=Object.keys(e);t<n.length;t++){var o=n[t];r=e[o];for(var a=0;a<rules.length;a++)if(rules[a].match(o,r)){rules[a].action(e,o,r);break}}return e}exports.transformStyle=transformStyle;
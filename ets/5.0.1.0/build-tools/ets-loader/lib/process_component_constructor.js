"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.addConstructor=addConstructor,exports.getInitConstructor=getInitConstructor,exports.updateConstructor=updateConstructor;var _typescript=_interopRequireDefault(require("typescript")),_pre_define=require("./pre_define");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}function getInitConstructor(e){var t=this;let r=e.find(function(e){return _newArrowCheck(this,t),_typescript.default.isConstructorDeclaration(e)}.bind(this));return r=r&&updateConstructor(r,[],[],!0),initConstructorParams(r)}function updateConstructor(t,e,r,a=!1,i=!1,o){let c;e&&e.length&&(c=Array.from(t.parameters),c&&c.push(...e));let n;if(r&&r.length&&t&&(n=Array.from(t.body.statements),n&&(a?n.unshift(...r):n.push(...r))),t){let e=c||t.parameters;i&&(e=addParamsType(t,c,o)),t=_typescript.default.factory.updateConstructorDeclaration(t,t.decorators,t.modifiers,e,_typescript.default.factory.createBlock(n||t.body.statements,!0))}return t}function initConstructorParams(e){var t=this;const r=[_pre_define.COMPONENT_CONSTRUCTOR_ID,_pre_define.COMPONENT_CONSTRUCTOR_PARENT,_pre_define.COMPONENT_CONSTRUCTOR_PARAMS],a=Array.from(e.parameters);return 0!==a.length&&a.splice(0,a.length),r.forEach(function(e){_newArrowCheck(this,t),a.push(_typescript.default.factory.createParameterDeclaration(void 0,void 0,void 0,_typescript.default.factory.createIdentifier(e),void 0,void 0,void 0))}.bind(this)),_typescript.default.factory.updateConstructorDeclaration(e,void 0,e.modifiers,a,e.body)}function addParamsType(e,t,r){var a=this;const i=t||e.parameters,o=[];return i.forEach(function(e){_newArrowCheck(this,a);let t=e;switch(e.name.escapedText){case _pre_define.COMPONENT_CONSTRUCTOR_ID:t=_typescript.default.factory.updateParameterDeclaration(e,e.decorators,e.modifiers,e.dotDotDotToken,e.name,e.questionToken,_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.StringKeyword),e.initializer);break;case _pre_define.COMPONENT_CONSTRUCTOR_PARENT:t=_typescript.default.factory.createParameterDeclaration(e.decorators,e.modifiers,e.dotDotDotToken,e.name,e.questionToken,_typescript.default.factory.createTypeReferenceNode(_typescript.default.factory.createIdentifier(_pre_define.BASE_COMPONENT_NAME),void 0),e.initializer);break;case _pre_define.COMPONENT_CONSTRUCTOR_PARAMS:t=_typescript.default.factory.updateParameterDeclaration(e,e.decorators,e.modifiers,e.dotDotDotToken,e.name,e.questionToken,_typescript.default.factory.createTypeReferenceNode(_typescript.default.factory.createIdentifier(r.getText()+_pre_define.INTERFACE_NAME_SUFFIX),void 0),e.initializer)}o.push(t)}.bind(this)),o}function addConstructor(e,t,r){var a=this;const i=[];t.forEach(function(e,t){_newArrowCheck(this,a);e=_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_WATCH_FUNCTION)),void 0,[_typescript.default.factory.createStringLiteral(t),_typescript.default.isStringLiteral(e)?_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier(e.text)):e]));i.push(e)}.bind(this));var o=_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createSuper(),void 0,[_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_ID),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_PARENT)])),t=_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UPDATE_PARAMS)),void 0,[_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_PARAMS)]));return updateConstructor(updateConstructor(e,[],[o],!0),[],[t,...i],!1,!0,r)}
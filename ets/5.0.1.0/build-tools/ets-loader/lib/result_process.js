"use strict";var _path=_interopRequireDefault(require("path")),_pre_define=require("./pre_define"),_process_ui_syntax=require("./process_ui_syntax"),_validate_ui_syntax=require("./validate_ui_syntax"),_utils=require("./utils"),_main=require("../main");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}module.exports=function(e,t){var i=this;if(process.env.compiler=_pre_define.BUILD_OFF,e=(0,_validate_ui_syntax.processSystemApi)(e,!0),/\.ets$/.test(this.resourcePath)&&(_utils.componentInfo.id=0,_validate_ui_syntax.propertyCollection.clear(),_validate_ui_syntax.linkCollection.clear(),(0,_validate_ui_syntax.resetComponentCollection)(),_process_ui_syntax.transformLog&&_process_ui_syntax.transformLog.errors.length)){const a=_process_ui_syntax.transformLog.sourceFile;var r=_process_ui_syntax.transformLog.errors.map(function(e){var t;return _newArrowCheck(this,i),e.pos?(t=a.getLineAndCharacterOfPosition(e.pos),e.line=t.line+1,e.column=t.character+1):(e.line=void 0,e.column=void 0),e.fileName=a.fileName,e}.bind(this));(0,_utils.emitLogInfo)(this,r),(0,_process_ui_syntax.resetLog)()}const n=[_main.abilityConfig.abilityEntryFile,"AbilityStage.ts"].concat(_main.abilityConfig.projectAbilityPath).concat(_main.abilityConfig.testRunnerFile);(n.includes(_path.default.basename(this.resourcePath))||n.includes(this.resourcePath))&&(e=e.replace(/exports\.default/,"globalThis.exports.default")),this.callback(null,e,t)};
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.builderParamObjectCollection=exports.appStorageDecorators=exports.UpdateResult=void 0,exports.createCustomComponentNewExpression=createCustomComponentNewExpression,exports.createViewCreate=createViewCreate,exports.immutableDecorators=exports.forbiddenSpecifyDefaultValueDecorators=exports.decoratorParamSet=exports.curPropMap=void 0,exports.isSimpleType=isSimpleType,exports.observedPropertyDecorators=exports.mandatoryToInitViaParamDecorators=exports.mandatorySpecifyDefaultValueDecorators=void 0,exports.processMemberVariableDecorators=processMemberVariableDecorators,exports.stateObjectCollection=exports.simpleTypes=exports.setUpdateParamsDecorators=exports.propAndLinkDecorators=void 0;var _typescript=_interopRequireDefault(require("typescript")),_pre_define=require("./pre_define"),_component_map=require("./component_map"),_validate_ui_syntax=require("./validate_ui_syntax"),_process_component_constructor=require("./process_component_constructor"),_utils=require("./utils"),_process_component_class=require("./process_component_class"),_main=require("../main");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const observedPropertyDecorators=new Set([_pre_define.COMPONENT_STATE_DECORATOR,_pre_define.COMPONENT_PROVIDE_DECORATOR]);exports.observedPropertyDecorators=observedPropertyDecorators;const propAndLinkDecorators=new Set([_pre_define.COMPONENT_PROP_DECORATOR,_pre_define.COMPONENT_LINK_DECORATOR]);exports.propAndLinkDecorators=propAndLinkDecorators;const appStorageDecorators=new Set([_pre_define.COMPONENT_STORAGE_PROP_DECORATOR,_pre_define.COMPONENT_STORAGE_LINK_DECORATOR]);exports.appStorageDecorators=appStorageDecorators;const mandatorySpecifyDefaultValueDecorators=new Set([...observedPropertyDecorators,...appStorageDecorators]);exports.mandatorySpecifyDefaultValueDecorators=mandatorySpecifyDefaultValueDecorators;const forbiddenSpecifyDefaultValueDecorators=new Set([...propAndLinkDecorators,_pre_define.COMPONENT_CONSUME_DECORATOR,_pre_define.COMPONENT_OBJECT_LINK_DECORATOR]);exports.forbiddenSpecifyDefaultValueDecorators=forbiddenSpecifyDefaultValueDecorators;const mandatoryToInitViaParamDecorators=new Set([...propAndLinkDecorators,_pre_define.COMPONENT_OBJECT_LINK_DECORATOR]);exports.mandatoryToInitViaParamDecorators=mandatoryToInitViaParamDecorators;const setUpdateParamsDecorators=new Set([...observedPropertyDecorators,_pre_define.COMPONENT_PROP_DECORATOR,_pre_define.COMPONENT_OBJECT_LINK_DECORATOR,_pre_define.COMPONENT_BUILDERPARAM_DECORATOR]);exports.setUpdateParamsDecorators=setUpdateParamsDecorators;const immutableDecorators=new Set([_pre_define.COMPONENT_STORAGE_PROP_DECORATOR,_pre_define.COMPONENT_OBJECT_LINK_DECORATOR,_pre_define.COMPONENT_BUILDERPARAM_DECORATOR]);exports.immutableDecorators=immutableDecorators;const simpleTypes=new Set([_typescript.default.SyntaxKind.StringKeyword,_typescript.default.SyntaxKind.NumberKeyword,_typescript.default.SyntaxKind.BooleanKeyword,_typescript.default.SyntaxKind.EnumDeclaration]);exports.simpleTypes=simpleTypes;const decoratorParamSet=new Set;exports.decoratorParamSet=decoratorParamSet;const stateObjectCollection=new Set;exports.stateObjectCollection=stateObjectCollection;const builderParamObjectCollection=new Map;exports.builderParamObjectCollection=builderParamObjectCollection;class UpdateResult{constructor(){_defineProperty(this,"itemUpdate",!1),_defineProperty(this,"ctorUpdate",!1),_defineProperty(this,"properity",void 0),_defineProperty(this,"ctor",void 0),_defineProperty(this,"variableGet",void 0),_defineProperty(this,"variableSet",void 0),_defineProperty(this,"updateParams",void 0),_defineProperty(this,"deleteParams",!1),_defineProperty(this,"controllerSet",void 0)}setProperity(e){this.itemUpdate=!0,this.properity=e}setCtor(e){this.ctorUpdate=!0,this.ctor=e}setControllerSet(e){this.controllerSet=e}getControllerSet(){return this.controllerSet}setVariableGet(e){this.variableGet=e}setVariableSet(e){this.variableSet=e}setUpdateParams(e){this.updateParams=e}setDeleteParams(e){this.deleteParams=e}isItemUpdate(){return this.itemUpdate}isCtorUpdate(){return this.ctorUpdate}getProperity(){return this.properity}getCtor(){return this.ctor}getUpdateParams(){return this.updateParams}getVariableGet(){return this.variableGet}getVariableSet(){return this.variableSet}isDeleteParams(){return this.deleteParams}}exports.UpdateResult=UpdateResult;const curPropMap=new Map;function processMemberVariableDecorators(e,t,r,a,o,i,s,p,n,c){const d=new UpdateResult,_=t.name;if(t.decorators&&t.decorators.length){if(!t.type)return validatePropertyNonType(_,i),d;processPropertyNodeDecorator(e,t,d,r,_,a,i,s,p,n,c)}else curPropMap.set(_.escapedText.toString(),_pre_define.COMPONENT_NON_DECORATOR),d.setProperity(void 0),d.setUpdateParams(createUpdateParams(_,_pre_define.COMPONENT_NON_DECORATOR)),d.setCtor((0,_process_component_constructor.updateConstructor)(r,[],[createVariableInitStatement(t,_pre_define.COMPONENT_NON_DECORATOR,i,s,p,n,c)])),d.setControllerSet(createControllerSet(t,e,_,o));return d}function createControllerSet(e,t,r,a){if(_validate_ui_syntax.componentCollection.customDialogs.has(t.getText())&&e.type&&e.type.getText()===_pre_define.SET_CONTROLLER_CTR_TYPE)return a.hasController=!0,_typescript.default.factory.createMethodDeclaration(void 0,void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.SET_CONTROLLER_METHOD),void 0,void 0,[_typescript.default.factory.createParameterDeclaration(void 0,void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.SET_CONTROLLER_CTR),void 0,_typescript.default.factory.createTypeReferenceNode(_typescript.default.factory.createIdentifier(_pre_define.SET_CONTROLLER_CTR_TYPE),void 0),void 0)],void 0,_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),r),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),_typescript.default.factory.createIdentifier(_pre_define.SET_CONTROLLER_CTR)))],!0))}function processPropertyNodeDecorator(t,r,a,o,i,s,p,n,c,d,_){let l=0;for(let e=0;e<r.decorators.length;e++){const y=r.decorators[e].getText().replace(/\(.*\)$/,"").trim();if(y!==_pre_define.COMPONENT_WATCH_DECORATOR&&curPropMap.set(i.escapedText.toString(),y),_component_map.BUILDIN_STYLE_NAMES.has(y.replace("@",""))&&validateDuplicateDecorator(r.decorators[e],p),y!==_pre_define.COMPONENT_WATCH_DECORATOR&&isForbiddenUseStateType(r.type))return void validateForbiddenUseStateType(i,y,r.type.typeName.getText(),p);if(t.getText()===_validate_ui_syntax.componentCollection.entryComponent&&mandatoryToInitViaParamDecorators.has(y)&&validateHasIllegalDecoratorInEntry(t,i,y,p),r.initializer&&forbiddenSpecifyDefaultValueDecorators.has(y))return void validatePropertyDefaultValue(i,y,p);if(!r.initializer&&mandatorySpecifyDefaultValueDecorators.has(y))return void validatePropertyNonDefaultValue(i,y,p);r.questionToken&&mandatoryToInitViaParamDecorators.has(y)&&validateHasIllegalQuestionToken(i,y,p),isSimpleType(r.type,n)||y===_pre_define.COMPONENT_BUILDERPARAM_DECORATOR||stateObjectCollection.add(i.escapedText.toString()),y===_pre_define.COMPONENT_WATCH_DECORATOR&&validateWatchDecorator(i,r.decorators.length,p)?processWatch(r,r.decorators[e],s,p):_pre_define.INNER_COMPONENT_MEMBER_DECORATORS.has(y)&&(l+=1,processStateDecorators(r,y,a,o,p,n,c,d,_))}1<l&&validateMultiDecorators(i,p)}function processStateDecorators(e,t,r,a,o,i,s,p,n){var c=e.name;r.setProperity(void 0);const d=[];n=createVariableInitStatement(e,t,o,i,s,p,n);n&&d.push(n),addAddProvidedVar(e,c,t,d),r.setCtor((0,_process_component_constructor.updateConstructor)(a,[],[...d],!1)),t!==_pre_define.COMPONENT_BUILDERPARAM_DECORATOR&&(r.setVariableGet(createGetAccessor(c,_pre_define.CREATE_GET_METHOD)),r.setDeleteParams(!0)),immutableDecorators.has(t)||r.setVariableSet(createSetAccessor(c,_pre_define.CREATE_SET_METHOD,e.type)),setUpdateParamsDecorators.has(t)&&r.setUpdateParams(createUpdateParams(c,t))}function processWatch(e,t,r,a){if(e.name){var o,i=e.name.getText();if(t.expression&&_typescript.default.isCallExpression(t.expression)&&t.expression.arguments&&1===t.expression.arguments.length){const s=_validate_ui_syntax.classMethodCollection.get(e.parent.name.getText()),p=t.expression.arguments[0];_typescript.default.isStringLiteral(p)?s.has(p.text)?r.set(i,p):a.push({type:_utils.LogType.ERROR,message:`Cannot find name ${p.getText()} in struct '${e.parent.name.getText()}'.`,pos:p.getStart()}):_typescript.default.isIdentifier(t.expression.arguments[0])?(e=createPropertyAccessExpressionWithThis(o=t.expression.arguments[0].getText()),r.set(i,e),decoratorParamSet.add(o),validateWatchParam(_utils.LogType.WARN,p.getStart(),a)):_typescript.default.isPropertyAccessExpression(t.expression.arguments[0])?(r.set(i,t.expression.arguments[0]),validateWatchParam(_utils.LogType.WARN,p.getStart(),a)):validateWatchParam(_utils.LogType.ERROR,p.getStart(),a)}}}function createVariableInitStatement(e,t,r,a,o,i,s){var p=e.name;let n,c;switch(e.type&&(n=e.type),t){case _pre_define.COMPONENT_NON_DECORATOR:c=updateNormalProperty(e,p,r,o);break;case _pre_define.COMPONENT_STATE_DECORATOR:case _pre_define.COMPONENT_PROVIDE_DECORATOR:c=updateObservedProperty(e,p,n,a);break;case _pre_define.COMPONENT_LINK_DECORATOR:wrongDecoratorInPreview(e,_pre_define.COMPONENT_LINK_DECORATOR,i,r),c=updateSynchedPropertyTwoWay(p,n,a);break;case _pre_define.COMPONENT_PROP_DECORATOR:wrongDecoratorInPreview(e,_pre_define.COMPONENT_PROP_DECORATOR,i,r),c=updateSynchedPropertyOneWay(p,n,t,r,a);break;case _pre_define.COMPONENT_STORAGE_PROP_DECORATOR:case _pre_define.COMPONENT_STORAGE_LINK_DECORATOR:var d=t===_pre_define.COMPONENT_STORAGE_PROP_DECORATOR?_pre_define.APP_STORAGE_SET_AND_PROP:_pre_define.APP_STORAGE_SET_AND_LINK;c=updateStoragePropAndLinkProperty(e,p,d,r);break;case _pre_define.COMPONENT_OBJECT_LINK_DECORATOR:c=updateSynchedPropertyNesedObject(p,n,t,r);break;case _pre_define.COMPONENT_CONSUME_DECORATOR:wrongDecoratorInPreview(e,_pre_define.COMPONENT_CONSUME_DECORATOR,i,r),c=updateConsumeProperty(e,p)}const _=s.members;return _.push(_typescript.default.factory.createPropertySignature(void 0,p,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.QuestionToken),n)),s=_typescript.default.factory.updateInterfaceDeclaration(s,void 0,s.modifiers,s.name,s.typeParameters,s.heritageClauses,_),c}function wrongDecoratorInPreview(e,t,r,a){r&&a.push({type:_utils.LogType.WARN,message:`The variable with ${t} in component with @Preview may `+"cause error in component preview mode",pos:e.getStart()})}function createUpdateParams(e,t){let r;switch(t){case _pre_define.COMPONENT_NON_DECORATOR:case _pre_define.COMPONENT_STATE_DECORATOR:case _pre_define.COMPONENT_PROVIDE_DECORATOR:r=createUpdateParamsWithIf(e);break;case _pre_define.COMPONENT_PROP_DECORATOR:r=createUpdateParamsWithoutIf(e);break;case _pre_define.COMPONENT_OBJECT_LINK_DECORATOR:r=createUpdateParamsWithSet(e);break;case _pre_define.COMPONENT_BUILDERPARAM_DECORATOR:t===_pre_define.COMPONENT_BUILDERPARAM_DECORATOR&&(builderParamObjectCollection.get(_validate_ui_syntax.componentCollection.currentClassName)||builderParamObjectCollection.set(_validate_ui_syntax.componentCollection.currentClassName,new Set([])),builderParamObjectCollection.get(_validate_ui_syntax.componentCollection.currentClassName).add(e.escapedText.toString())),r=createUpdateParamsWithoutIf(e)}return r}function createUpdateParamsWithIf(e){return _typescript.default.factory.createIfStatement(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.CREATE_CONSTRUCTOR_PARAMS),_typescript.default.factory.createIdentifier(e.escapedText.toString())),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.ExclamationEqualsEqualsToken),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED)),_typescript.default.factory.createBlock([createUpdateParamsWithoutIf(e)],!0),void 0)}function createUpdateParamsWithoutIf(e){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(createPropertyAccessExpressionWithThis(e.getText()),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),createPropertyAccessExpressionWithParams(e.getText())))}function createUpdateParamsWithSet(e){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(createPropertyAccessExpressionWithThis("__"+e.getText()),_typescript.default.factory.createIdentifier(_pre_define.CREATE_SET_METHOD)),void 0,[createPropertyAccessExpressionWithParams(e.getText())]))}function updateNormalProperty(e,t,r,a){r=_typescript.default.visitNode(processCustomDialogController(e,r),function e(t){(0,_process_component_class.isProperty)(t)&&(t=(0,_process_component_class.createReference)(t));return _typescript.default.visitEachChild(t,e,a)});return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(createPropertyAccessExpressionWithThis(t.getText()),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),r||_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED)))}function processCustomDialogController(e,t){return e.initializer&&_typescript.default.isNewExpression(e.initializer)&&_typescript.default.isIdentifier(e.initializer.expression)&&e.initializer.expression.getText()===_pre_define.SET_CONTROLLER_CTR_TYPE?createCustomDialogController(e,e.initializer,t):e.initializer}function createCustomDialogController(t,e,r){var a=this;if(e.arguments&&1===e.arguments.length&&_typescript.default.isObjectLiteralExpression(e.arguments[0])&&e.arguments[0].properties){var o=e.arguments[0].properties.map(function(e){return _newArrowCheck(this,a),e=isCustomDialogControllerPropertyAssignment(e,r)?processCustomDialogControllerPropertyAssignment(t,e):e}.bind(this));return _typescript.default.factory.createNewExpression(e.expression,e.typeArguments,[_typescript.default.factory.createObjectLiteralExpression(o,!0),_typescript.default.factory.createThis()])}}function isCustomDialogControllerPropertyAssignment(e,t){if(_typescript.default.isPropertyAssignment(e)&&_typescript.default.isIdentifier(e.name)&&e.name.getText()===_pre_define.CUSTOM_DIALOG_CONTROLLER_BUILDER){if(_typescript.default.isCallExpression(e.initializer)&&_typescript.default.isIdentifier(e.initializer.expression)&&_validate_ui_syntax.componentCollection.customDialogs.has(e.initializer.expression.getText()))return!0;validateCustomDialogControllerBuilderInit(e,t)}}function processCustomDialogControllerPropertyAssignment(e,t){if(_typescript.default.isCallExpression(t.initializer))return _typescript.default.factory.updatePropertyAssignment(t,t.name,processCustomDialogControllerBuilder(e,t.initializer))}function processCustomDialogControllerBuilder(e,t){t=createCustomComponentNewExpression(t);return createCustomComponentBuilderArrowFunction(e,_typescript.default.factory.createIdentifier(_pre_define.JS_DIALOG),t)}function updateObservedProperty(e,t,r,a){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(createPropertyAccessExpressionWithThis("__"+t.getText()),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),_typescript.default.factory.createNewExpression(_typescript.default.factory.createIdentifier(isSimpleType(r,a)?_pre_define.OBSERVED_PROPERTY_SIMPLE:_pre_define.OBSERVED_PROPERTY_OBJECT),void 0,[e.initializer,_typescript.default.factory.createThis(),_typescript.default.factory.createStringLiteral(t.escapedText.toString())])))}function updateSynchedPropertyTwoWay(e,t,r){e=e.escapedText.toString();return createInitExpressionStatementForDecorator(e,isSimpleType(t,r)?_pre_define.SYNCHED_PROPERTY_SIMPLE_TWO_WAY:_pre_define.SYNCHED_PROPERTY_OBJECT_TWO_WAY,createPropertyAccessExpressionWithParams(e))}function updateSynchedPropertyOneWay(e,t,r,a,o){var i=e.escapedText.toString();if(isSimpleType(t,o))return createInitExpressionStatementForDecorator(i,_pre_define.SYNCHED_PROPERTY_SIMPLE_ONE_WAY,createPropertyAccessExpressionWithParams(i));validateNonSimpleType(e,r,a)}function updateStoragePropAndLinkProperty(e,t,r,a){if(isSingleKey(e)){var o=getDecoratorKey(e);return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(createPropertyAccessExpressionWithThis("__"+t.getText()),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.APP_STORAGE),_typescript.default.factory.createIdentifier(_pre_define.APP_STORAGE_GET_OR_SET)),void 0,[]),_typescript.default.factory.createIdentifier(r)),void 0,[_typescript.default.factory.createStringLiteral(o),e.initializer,_typescript.default.factory.createThis()])))}validateAppStorageDecoractorsNonSingleKey(e,a)}function getDecoratorKey(e){let t;const r=e.decorators[0].expression.arguments[0];return _typescript.default.isIdentifier(r)?(t=r.getText(),decoratorParamSet.add(t)):_typescript.default.isStringLiteral(r)&&(t=r.text),t}function updateSynchedPropertyNesedObject(e,t,r,a){if(isObservedClassType(t))return createInitExpressionStatementForDecorator(e.getText(),_pre_define.SYNCHED_PROPERTY_NESED_OBJECT,createPropertyAccessExpressionWithParams(e.getText()));validateNonObservedClassType(e,r,a)}function updateConsumeProperty(e,t){t=t.getText();let r;return r=isSingleKey(e)?getDecoratorKey(e):t,_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(createPropertyAccessExpressionWithThis("__"+t),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),_typescript.default.factory.createCallExpression(createPropertyAccessExpressionWithThis(_pre_define.INITIALIZE_CONSUME_FUNCTION),void 0,[_typescript.default.factory.createStringLiteral(r),_typescript.default.factory.createStringLiteral(t)])))}function createCustomComponentBuilderArrowFunction(e,t,r){return _typescript.default.factory.createArrowFunction(void 0,void 0,[],void 0,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsGreaterThanToken),_typescript.default.factory.createBlock([_typescript.default.factory.createVariableStatement(void 0,_typescript.default.factory.createVariableDeclarationList([_typescript.default.factory.createVariableDeclaration(t,void 0,void 0,r)],_typescript.default.NodeFlags.Let)),_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(t,_typescript.default.factory.createIdentifier(_pre_define.SET_CONTROLLER_METHOD)),void 0,[_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),e.name)])),_typescript.default.factory.createExpressionStatement(createViewCreate(t))],!0))}function createViewCreate(e){return(0,_utils.createFunction)(_typescript.default.factory.createIdentifier(_pre_define.BASE_COMPONENT_NAME),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_FUNCTION),_typescript.default.factory.createNodeArray([e]))}function createCustomComponentNewExpression(e){return addCustomComponentId(_typescript.default.factory.createNewExpression(e.expression,e.typeArguments,e.arguments.length?e.arguments:[]))}function addCustomComponentId(a){var o=this;for(const e of _validate_ui_syntax.componentCollection.customComponents)_utils.componentInfo.componentNames.add(e);return _utils.componentInfo.componentNames.forEach(function(e){_newArrowCheck(this,o);var t=a.expression;let r;a.arguments&&a.arguments.length&&(r=Array.from(a.arguments)),t&&(_typescript.default.isIdentifier(t)&&t.escapedText===e||_typescript.default.isPropertyAccessExpression(t)&&_typescript.default.isIdentifier(t.name)&&t.name.escapedText===e)?(r=r||[_typescript.default.factory.createObjectLiteralExpression([],!0)],r.unshift(_typescript.default.factory.createStringLiteral((++_utils.componentInfo.id).toString()),_typescript.default.factory.createThis()),a=_typescript.default.factory.updateNewExpression(a,a.expression,a.typeArguments,r)):r&&(a=_typescript.default.factory.updateNewExpression(a,a.expression,a.typeArguments,r))}.bind(this)),a}function createInitExpressionStatementForDecorator(e,t,r){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(createPropertyAccessExpressionWithThis("__"+e),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),_typescript.default.factory.createNewExpression(_typescript.default.factory.createIdentifier(t),void 0,[r,_typescript.default.factory.createThis(),_typescript.default.factory.createStringLiteral(e)])))}function createPropertyAccessExpressionWithParams(e){return _typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.CREATE_CONSTRUCTOR_PARAMS),_typescript.default.factory.createIdentifier(e))}function createPropertyAccessExpressionWithThis(e){return _typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier(e))}function addAddProvidedVar(e,t,r,a){r===_pre_define.COMPONENT_PROVIDE_DECORATOR&&(isSingleKey(e)&&a.push(createAddProvidedVar(getDecoratorKey(e),t)),a.push(createAddProvidedVar(t.getText(),t)))}function createAddProvidedVar(e,t){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(createPropertyAccessExpressionWithThis(_pre_define.ADD_PROVIDED_VAR),void 0,[_typescript.default.factory.createStringLiteral(e),createPropertyAccessExpressionWithThis("__"+t.getText())]))}function createGetAccessor(e,t){return _typescript.default.factory.createGetAccessorDeclaration(void 0,void 0,e,[],void 0,_typescript.default.factory.createBlock([_typescript.default.factory.createReturnStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(createPropertyAccessExpressionWithThis("__"+e.getText()),_typescript.default.factory.createIdentifier(t)),void 0,[]))],!0))}function createSetAccessor(e,t,r){return _typescript.default.factory.createSetAccessorDeclaration(void 0,void 0,e,[_typescript.default.factory.createParameterDeclaration(void 0,void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.CREATE_NEWVALUE_IDENTIFIER),void 0,r,void 0)],_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(createPropertyAccessExpressionWithThis("__"+e.getText()),_typescript.default.factory.createIdentifier(t)),void 0,[_typescript.default.factory.createIdentifier(_pre_define.CREATE_NEWVALUE_IDENTIFIER)]))],!0))}function isForbiddenUseStateType(e){return!!(_typescript.default.isTypeReferenceNode(e)&&_typescript.default.isIdentifier(e.typeName)&&_component_map.forbiddenUseStateType.has(e.typeName.getText()))}function isSimpleType(t,e){let r;_main.globalProgram.program?r=_main.globalProgram.program.getTypeChecker():e&&(r=e.getTypeChecker());const a=getEnumType(t,r);if(simpleTypes.has(a||t.kind)||isEnumtype(t))return!0;if(_typescript.default.isUnionTypeNode(t)&&t.types){var o=t.types;for(let e=0;e<o.length;e++){const a=getEnumType(o[e],r);if(!simpleTypes.has(a||o[e].kind)&&!isEnumtype(t))return!1}return!0}return!1}function getEnumType(e,t){if(t&&_typescript.default.isTypeReferenceNode(e)&&_typescript.default.isIdentifier(e.typeName)){e=t.getBaseTypeOfLiteralType(t.getTypeAtLocation(e.typeName));if(e.symbol&&e.symbol.valueDeclaration)return e.symbol.valueDeclaration.kind}}function isEnumtype(e){if(_typescript.default.isTypeReferenceNode(e)&&_typescript.default.isIdentifier(e.typeName))return _validate_ui_syntax.enumCollection.has(e.typeName.getText())}function isObservedClassType(e){if(_typescript.default.isTypeReferenceNode(e)&&_validate_ui_syntax.observedClassCollection.has(e.getText()))return!0;if(_typescript.default.isUnionTypeNode(e)&&e.types){const t=e.types;for(let e=0;e<t.length;e++)if(!_validate_ui_syntax.observedClassCollection.has(t[e].getText()))return!1;return!0}return!1}function validateAppStorageDecoractorsNonSingleKey(e,t){_typescript.default.isIdentifier(e.decorators[0].expression)?validateDecoratorNonSingleKey(e.decorators[0].expression,t):_typescript.default.isCallExpression(e.decorators[0].expression)&&_typescript.default.isIdentifier(e.decorators[0].expression.expression)&&validateDecoratorNonSingleKey(e.decorators[0].expression.expression,t)}function isSingleKey(e){if(_typescript.default.isCallExpression(e.decorators[0].expression)&&e.decorators[0].expression.arguments&&1===e.decorators[0].expression.arguments.length&&(_typescript.default.isIdentifier(e.decorators[0].expression.arguments[0])||_typescript.default.isStringLiteral(e.decorators[0].expression.arguments[0])))return!0}function validateMultiDecorators(e,t){t.push({type:_utils.LogType.ERROR,message:`The property '${e.escapedText.toString()}' cannot have mutilate state management decorators.`,pos:e.getStart()})}function validateDecoratorNonSingleKey(e,t){t.push({type:_utils.LogType.ERROR,message:`The decorator ${e.escapedText.toString()} should have a single key.`,pos:e.getStart()})}function validatePropertyNonDefaultValue(e,t,r){r.push({type:_utils.LogType.ERROR,message:`The ${t} property '${e.getText()}' must be specified a default value.`,pos:e.getStart()})}function validatePropertyDefaultValue(e,t,r){r.push({type:_utils.LogType.ERROR,message:`The ${t} property '${e.getText()}' cannot be specified a default value.`,pos:e.getStart()})}function validatePropertyNonType(e,t){t.push({type:_utils.LogType.ERROR,message:`The property '${e.getText()}' must specify a type.`,pos:e.getStart()})}function validateNonSimpleType(e,t,r){r.push({type:_utils.LogType.ERROR,message:`The type of the ${t} property '${e.getText()}' `+"can only be string, number or boolean.",pos:e.getStart()})}function validateNonObservedClassType(e,t,r){r.push({type:_utils.LogType.ERROR,message:`The type of the ${t} property '${e.getText()}' can only be `+`objects of classes decorated with ${_pre_define.COMPONENT_OBSERVED_DECORATOR} class decorator in ets (not ts).`,pos:e.getStart()})}function validateHasIllegalQuestionToken(e,t,r){r.push({type:_utils.LogType.WARN,message:`The ${t} property '${e.getText()}' cannot be an optional parameter.`,pos:e.getStart()})}function validateHasIllegalDecoratorInEntry(e,t,r,a){a.push({type:_utils.LogType.WARN,message:`The @Entry component '${e.getText()}' cannot have the `+`${r} property '${t.getText()}'.`,pos:t.getStart()})}function validateForbiddenUseStateType(e,t,r,a){a.push({type:_utils.LogType.ERROR,message:`The ${t} property '${e.getText()}' cannot be a '${r}' object.`,pos:e.getStart()})}function validateDuplicateDecorator(e,t){t.push({type:_utils.LogType.ERROR,message:`The decorator '${e.getText()}' cannot have the same name as the build-in `+`style attribute '${e.getText().replace("@","")}'.`,pos:e.getStart()})}function validateWatchDecorator(e,t,r){return 1!==t||(r.push({type:_utils.LogType.ERROR,message:`Regular variable '${e.escapedText.toString()}' can not be decorated with @Watch.`,pos:e.getStart()}),!1)}function validateWatchParam(e,t,r){r.push({type:e,message:"The parameter should be a string.",pos:t})}function validateCustomDialogControllerBuilderInit(e,t){t.push({type:_utils.LogType.ERROR,message:"The builder should be initialized with a @CustomDialog Component.",pos:e.getStart()})}exports.curPropMap=curPropMap;
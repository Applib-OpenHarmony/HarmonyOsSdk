"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LogType=exports.IGNORE_ERROR_CODE=exports.FileLog=void 0,exports.addLog=addLog,exports.circularFile=circularFile,exports.componentInfo=void 0,exports.createFunction=createFunction,exports.emitLogInfo=emitLogInfo,exports.getMessage=getMessage,exports.hasDecorator=hasDecorator,exports.readFile=readFile;var LogType,_typescript=_interopRequireDefault(require("typescript")),_path=_interopRequireDefault(require("path")),_fs=_interopRequireDefault(require("fs"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(e){e.ERROR="ERROR",e.WARN="WARN",e.NOTE="NOTE"}((exports.LogType=LogType)||(exports.LogType=LogType={}));var FileLog=function(){function e(){_classCallCheck(this,e),_defineProperty(this,"_sourceFile",void 0),_defineProperty(this,"_errors",[])}return _createClass(e,[{key:"sourceFile",get:function(){return this._sourceFile},set:function(e){this._sourceFile=e}},{key:"errors",get:function(){return this._errors},set:function(e){this._errors=e}}]),e}();function emitLogInfo(t,e){var r=this;e&&e.length&&e.forEach(function(e){switch(_newArrowCheck(this,r),e.type){case LogType.ERROR:t.emitError(getMessage(t.resourcePath,e));break;case LogType.WARN:case LogType.NOTE:t.emitWarning(getMessage(t.resourcePath,e))}}.bind(this))}function addLog(e,t,r,o,n){r=n.getLineAndCharacterOfPosition(r);o.push({type:e,message:t,line:r.line+1,column:r.character+1,fileName:n.fileName})}function getMessage(e,t){t=(t.line&&t.column?"BUILD".concat(t.type," File: ").concat(e,":").concat(t.line,":").concat(t.column,"\n "):"BUILD".concat(t.type," File: ").concat(e,"\n ")).concat(t.message);return t}exports.FileLog=FileLog;var ComponentInfo=function(){function e(){_classCallCheck(this,e),_defineProperty(this,"_id",0),_defineProperty(this,"_componentNames",new Set(["ForEach"]))}return _createClass(e,[{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"componentNames",get:function(){return this._componentNames},set:function(e){this._componentNames=e}}]),e}(),componentInfo=new ComponentInfo;function hasDecorator(e,t){if(e.decorators&&e.decorators.length)for(var r=0;r<e.decorators.length;r++)if(e.decorators[r].getText()===t)return!0;return!1}exports.componentInfo=componentInfo;var STATEMENT_EXPECT=1128,SEMICOLON_EXPECT=1005,STATESTYLES_EXPECT=1003,IGNORE_ERROR_CODE=[STATEMENT_EXPECT,SEMICOLON_EXPECT,STATESTYLES_EXPECT];function readFile(t,r){var o=this;try{_fs.default.readdirSync(t).forEach(function(e){_newArrowCheck(this,o);e=_path.default.join(t,e);_fs.default.statSync(e).isDirectory()?readFile(e,r):r.push(e)}.bind(this))}catch(e){console.error("ETS ERROR: "+e)}}function createFunction(e,t,r){return _typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(e,t),void 0,r&&r.length?r:[])}function circularFile(o,n){o&&n&&_fs.default.readdir(o,function(e,t){var r=this;t&&t.forEach(function(e){_newArrowCheck(this,r);var t=_path.default.resolve(o,e),e=_path.default.resolve(n,e);(_fs.default.statSync(t).isFile()?copyFile:circularFile)(t,e)}.bind(this))})}function copyFile(e,t){try{var r=_path.default.join(t,"..");if(_fs.default.existsSync(r)&&_fs.default.statSync(r).isDirectory()||mkDir(r),_fs.default.existsSync(t))return;var o=_fs.default.createReadStream(e),n=_fs.default.createWriteStream(t);o.pipe(n),o.on("close",function(){n.end()})}catch(e){throw e.message}}function mkDir(e){var t=_path.default.join(e,"..");_fs.default.existsSync(t)&&!_fs.default.statSync(t).isFile()||mkDir(t),_fs.default.mkdirSync(e)}exports.IGNORE_ERROR_CODE=IGNORE_ERROR_CODE;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.appComponentCollection=void 0,exports.bindComponentAttr=bindComponentAttr,exports.getName=getName,exports.isAttributeNode=isAttributeNode,exports.processComponentBlock=processComponentBlock,exports.processComponentBuild=processComponentBuild,exports.processComponentChild=processComponentChild,exports.validateStateStyleSyntax=validateStateStyleSyntax;var _typescript=_interopRequireDefault(require("typescript")),_path=_interopRequireDefault(require("path")),_pre_define=require("./pre_define"),_component_map=require("./component_map"),_validate_ui_syntax=require("./validate_ui_syntax"),_process_custom_component=require("./process_custom_component"),_utils=require("./utils"),_main=require("../main"),_process_ui_syntax=require("./process_ui_syntax"),_compile_info=require("./compile_info");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}var appComponentCollection=new Set;function processComponentBuild(e,t){var r=_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_RENDER_FUNCTION),e=e.body&&e.body.statements&&e.body.statements.length&&validateRootNode(e,t)?_typescript.default.factory.updateMethodDeclaration(e,e.decorators,e.modifiers,e.asteriskToken,r,e.questionToken,e.typeParameters,e.parameters,e.type,processComponentBlock(e.body,!1,t)):_typescript.default.factory.updateMethodDeclaration(e,e.decorators,e.modifiers,e.asteriskToken,r,e.questionToken,e.typeParameters,e.parameters,e.type,e.body);return e}function processComponentBlock(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],a=[];return processComponentChild(e,a,r),t&&a.unshift(createRenderingInProgress(!0)),n&&(a.unshift(_typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_TRANSITION_NAME),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_FUNCTION),null))),a.push(_typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_TRANSITION_NAME),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_POP_FUNCTION),null)))),t&&a.push(createRenderingInProgress(!1)),_typescript.default.factory.updateBlock(e,a)}function validateRootNode(e,t){var r=!1;if(e.body.statements.length<4)switch(e.body.statements.length){case 1:validateFirstNode(e.body.statements[0])&&(r=!0);break;case 2:validateFirstNode(e.body.statements[0])&&validateBlockNode(e.body.statements[1])&&(r=!0);break;case 3:validateFirstNode(e.body.statements[0])&&validateBlockNode(e.body.statements[1])&&validateSecondNode(e.body.statements[2])&&(r=!0)}return r||t.push({type:_utils.LogType.ERROR,message:"There should have a root container component.",pos:e.body.statements.pos}),r}function processComponentChild(n,a,o){var i=this;n.statements.length&&n.statements.forEach(function(e,t){if(_newArrowCheck(this,i),_typescript.default.isExpressionStatement(e)){var r=getName(e);switch(getComponentType(e,o,r)){case ComponentType.innerComponent:processInnerComponent(e,t,Array.from(n.statements),a,o,r);break;case ComponentType.customComponent:(0,_process_custom_component.processCustomComponent)(e,a,o);break;case ComponentType.forEachComponent:processForEachComponent(e,a,o);break;case ComponentType.customBuilderMethod:a.push(e)}}else _typescript.default.isIfStatement(e)?(appComponentCollection.add(_pre_define.COMPONENT_IF),processIfStatement(e,a,o)):_typescript.default.isBlock(e)||o.push({type:_utils.LogType.ERROR,message:"Only UI component syntax can be written in build method.",pos:e.getStart()})}.bind(this))}function processInnerComponent(e,t,r,n,a,o){var i,s,p=createComponent(e,_pre_define.COMPONENT_CREATE_FUNCTION);n.push(p.newNode),_main.projectConfig.isPreview&&!_component_map.NO_DEBUG_LINE_COMPONENT.has(o)&&(s=_process_ui_syntax.transformLog.sourceFile.getLineAndCharacterOfPosition(getRealNodePos(e)),i=_main.projectConfig.projectPath,o=_process_ui_syntax.transformLog.sourceFile.fileName.replace(/.ts$/,""),s="".concat(_path.default.relative(i,o).replace(/\\+/g,"/"))+"(".concat(s.line+1,":").concat(s.character+1,")"),s=_typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(_typescript.default.factory.createIdentifier(getName(e)),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_DEBUGLINE_FUNCTION),_typescript.default.factory.createNodeArray([_typescript.default.factory.createStringLiteral(s)]))),n.push(s)),t+1<r.length&&_typescript.default.isBlock(r[t+1])?(p.isButton&&(_main.projectConfig.isPreview?n.splice(-2,1,createComponent(e,_pre_define.COMPONENT_CREATE_CHILD_FUNCTION).newNode):n.splice(-1,1,createComponent(e,_pre_define.COMPONENT_CREATE_CHILD_FUNCTION).newNode)),t+2<r.length&&_typescript.default.isExpressionStatement(r[t+2])&&isAttributeNode(r[t+2])&&bindComponentAttr(r[t+2],p.identifierNode,n,a),processComponentChild(r[t+1],n,a)):bindComponentAttr(e,p.identifierNode,n,a),(p.isContainerComponent||p.needPop)&&n.push(createComponent(e,_pre_define.COMPONENT_POP_FUNCTION).newNode)}function getRealNodePos(e){return-1===e.pos&&e.expression?getRealNodePos(e.expression):e.getStart()}function processForEachComponent(e,t,r){var n,a,o,i=_typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(e.expression.expression,_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_POP_FUNCTION),null));_typescript.default.isCallExpression(e.expression)&&(n=_typescript.default.factory.createPropertyAccessExpression(e.expression.expression,_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_FUNCTION)),(a=Array.from(e.expression.arguments)).length&&(o=_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.FOREACH_OBSERVED_OBJECT),_typescript.default.factory.createIdentifier(_pre_define.FOREACH_GET_RAW_OBJECT)),void 0,[a[0]])),a.splice(0,1,o),(r=processForEachBlock(e.expression,r))&&a.splice(1,1,r),e=addForEachId(_typescript.default.factory.updateExpressionStatement(e,_typescript.default.factory.updateCallExpression(e.expression,n,e.expression.typeArguments,a)))),t.push(e,i)}function addForEachId(e){var t=e.expression;return _typescript.default.factory.updateExpressionStatement(e,_typescript.default.factory.updateCallExpression(t,t.expression,t.typeArguments,[_typescript.default.factory.createStringLiteral((++_utils.componentInfo.id).toString()),_typescript.default.factory.createThis()].concat(_toConsumableArray(t.arguments))))}function processForEachBlock(e,t){if(1<e.arguments.length&&_typescript.default.isArrowFunction(e.arguments[1])){var r=e.expression.getText()===_pre_define.COMPONENT_LAZYFOREACH,n=e.arguments[1],a=n.body;if(!(2<e.arguments.length)||_typescript.default.isArrowFunction(e.arguments[2])){if(_typescript.default.isBlock(a))return _typescript.default.factory.updateArrowFunction(n,n.modifiers,n.typeParameters,n.parameters,n.type,n.equalsGreaterThanToken,processComponentBlock(a,r,t));var o=_typescript.default.factory.createExpressionStatement(a),e=_typescript.default.factory.createBlock([o],!0);return o.parent=e,_typescript.default.factory.updateArrowFunction(n,n.modifiers,n.typeParameters,n.parameters,n.type,n.equalsGreaterThanToken,processComponentBlock(e,r,t))}t.push({type:_utils.LogType.ERROR,message:"There should be wrapped in curly braces in ForEach.",pos:a.getStart()})}return null}function createRenderingInProgress(e){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier(_pre_define.IS_RENDERING_IN_PROGRESS)),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),e?_typescript.default.factory.createTrue():_typescript.default.factory.createFalse()))}function processIfStatement(e,t,r){var n=createIfCreate(),e=processInnerIfStatement(e,0,r),r=createIfPop();t.push(n,e,r)}function processInnerIfStatement(e,t,r){_typescript.default.isIdentifier(e.expression)&&void 0===e.expression.originalKeywordKind&&!e.expression.escapedText&&(r.push({type:_utils.LogType.ERROR,message:"Condition expression cannot be null in if statement.",pos:e.expression.getStart()}),e=_typescript.default.factory.updateIfStatement(e,_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_IF_UNDEFINED),e.thenStatement,e.elseStatement));var n=processThenStatement(e.thenStatement,t,r),r=processElseStatement(e.elseStatement,t,r);return _typescript.default.factory.updateIfStatement(e,e.expression,n,r)}function processThenStatement(e,t,r){return _typescript.default.isExpressionStatement(e)&&_typescript.default.isIdentifier(e.expression)&&void 0===e.expression.originalKeywordKind&&!e.expression.escapedText&&r.push({type:_utils.LogType.ERROR,message:"Then statement cannot be null in if statement.",pos:e.expression.getStart()}),e=e&&(_typescript.default.isBlock(e)?processIfBlock(e,t,r):_typescript.default.isIfStatement(e)?(e=processInnerIfStatement(e,0,r),_typescript.default.factory.createBlock([createIfCreate(),createIfBranchId(t),e,createIfPop()],!0)):processIfBlock(e=_typescript.default.factory.createBlock([e],!0),t,r))}function processElseStatement(e,t,r){return e=e&&(_typescript.default.isBlock(e)?processIfBlock(e,t+1,r):_typescript.default.isIfStatement(e)?processInnerIfStatement(e,t+1,r):processIfBlock(e=_typescript.default.factory.createBlock([e],!0),t+1,r))}function processIfBlock(e,t,r){return addIfBranchId(t,processComponentBlock(e,!1,r))}function addIfBranchId(e,t){return _typescript.default.factory.updateBlock(t,[createIfBranchId(e)].concat(_toConsumableArray(t.statements)))}function createIf(){return _typescript.default.factory.createIdentifier(_pre_define.COMPONENT_IF)}function createIfCreate(){return _typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(createIf(),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_FUNCTION),_typescript.default.factory.createNodeArray([])))}function createIfPop(){return _typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(createIf(),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_POP_FUNCTION),null))}function createIfBranchId(e){return _typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(createIf(),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_IF_BRANCH_ID_FUNCTION),_typescript.default.factory.createNodeArray([_typescript.default.factory.createNumericLiteral(e)])))}function createComponent(e,t){for(var r={newNode:e,identifierNode:null,isContainerComponent:!1,isButton:!1,needPop:!1},n=_typescript.default.factory.createIdentifier(t),a=e.expression;a&&!_typescript.default.isIdentifier(a)&&a.expression;)a=a.expression;return a&&a.parent&&_typescript.default.isCallExpression(a.parent)&&_typescript.default.isIdentifier(a)&&(a.getText()===_pre_define.COMPONENT_BUTTON&&t!==_pre_define.COMPONENT_POP_FUNCTION&&(r.isButton=!0,n=t===_pre_define.COMPONENT_CREATE_CHILD_FUNCTION?_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_CHILD_FUNCTION):_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_LABEL_FUNCTION)),_component_map.NEEDPOP_COMPONENT.has(a.getText())&&(r.needPop=!0),_component_map.BUILDIN_CONTAINER_COMPONENT.has(a.getText())&&(r.isContainerComponent=!0),r.newNode=t===_pre_define.COMPONENT_POP_FUNCTION?_typescript.default.factory.updateExpressionStatement(e,(0,_utils.createFunction)(a,n,null)):_typescript.default.factory.updateExpressionStatement(e,(0,_utils.createFunction)(a,n,a.parent.arguments)),r.identifierNode=a),r}function bindComponentAttr(e,t,r,n){for(var a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],o=5<arguments.length&&void 0!==arguments[5]&&arguments[5],i=e.expression,s=[],p={statement:null,kind:!1};i&&_typescript.default.isCallExpression(i)&&i.expression;)if(_typescript.default.isPropertyAccessExpression(i.expression)&&i.expression.name&&_typescript.default.isIdentifier(i.expression.name))addComponentAttr(i,i.expression.name,p,s,t,n,o),i=i.expression.expression;else if(_typescript.default.isIdentifier(i.expression)){_component_map.INNER_COMPONENT_NAMES.has(i.expression.getText())||_component_map.GESTURE_TYPE_NAMES.has(i.expression.getText())||addComponentAttr(i,i.expression,p,s,t,n,o);break}p.statement&&p.kind&&s.push(p.statement),s.length&&(a?r.push.apply(r,_toConsumableArray(s.reverse())):r.push.apply(r,s))}function createArrowFunctionFor$$(e){return _typescript.default.factory.createArrowFunction(void 0,void 0,[_typescript.default.factory.createParameterDeclaration(void 0,void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.$$_NEW_VALUE),void 0,void 0,void 0)],void 0,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsGreaterThanToken),_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(e,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),_typescript.default.factory.createIdentifier(_pre_define.$$_NEW_VALUE)))],!1))}function updateArgumentFor$$(e){return _typescript.default.isElementAccessExpression(e)?_typescript.default.factory.updateElementAccessExpression(e,updateArgumentFor$$(e.expression),e.argumentExpression):_typescript.default.isIdentifier(e)?(_compile_info.props.push(e.getText()),e.getText()===_pre_define.$$_THIS?_typescript.default.factory.createThis():e.getText().match(/^\$\$(.|\n)+/)?_typescript.default.factory.createIdentifier(e.getText().replace(/\$\$/,"")):void 0):_typescript.default.isPropertyAccessExpression(e)?_typescript.default.factory.updatePropertyAccessExpression(e,updateArgumentFor$$(e.expression),e.name):void 0}function addComponentAttr(e,t,r,n,a,o,i){var s,p,c=t.getText();c===_pre_define.ATTRIBUTE_ANIMATION?(r.statement?n.push(r.statement):1===e.arguments.length&&e.arguments[0].kind===_typescript.default.SyntaxKind.NullKeyword||n.push(_typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(_typescript.default.factory.createIdentifier(_pre_define.GLOBAL_CONTEXT),t,[_typescript.default.factory.createNull()]))),r.statement=_typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(_typescript.default.factory.createIdentifier(_pre_define.GLOBAL_CONTEXT),t,e.arguments)),r.kind=!1):_component_map.GESTURE_ATTRS.has(c)?(parseGesture(e,c,n,o),r.kind=!0):isExtendFunctionNode(a,c)?(validateExtendParameterCount(e,a,c,o),n.push(_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createIdentifier("__".concat(a.escapedText.toString(),"__").concat(c)),void 0,e.arguments))),r.kind=!0):c===_pre_define.ATTRIBUTE_STATESTYLES?1===e.arguments.length&&_typescript.default.isObjectLiteralExpression(e.arguments[0])?(n.push(createViewStackProcessor(e,!0)),traverseStateStylesAttr(e,n,a,o),r.kind=!0):validateStateStyleSyntax(e,o):_component_map.GLOBAL_STYLE_FUNCTION.has(c)||_component_map.INNER_STYLE_FUNCTION.has(c)?bindComponentAttr((_component_map.GLOBAL_STYLE_FUNCTION.get(c)||_component_map.INNER_STYLE_FUNCTION.get(c)).statements[0],a,n,o,!1,!0):(c===_pre_define.BIND_POPUP&&2===e.arguments.length&&e.arguments[0].getText().match(/^\$\$(.|\n)+/)?(s=[],p=updateArgumentFor$$(e.arguments[0]),s.push(generateObjectFor$$(p)),s.push(e.arguments[1]),n.push(_typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(a,t,s)))):(i&&!_component_map.COMMON_ATTRS.has(c)&&validateStateStyleSyntax(e,o),n.push(_typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(a,t,e.arguments)))),r.kind=!0)}function generateObjectFor$$(e){return _typescript.default.factory.createObjectLiteralExpression([_typescript.default.factory.createPropertyAssignment(_typescript.default.factory.createIdentifier(_pre_define.$$_VALUE),e),_typescript.default.factory.createPropertyAssignment(_typescript.default.factory.createIdentifier(_pre_define.$$_CHANGE_EVENT),createArrowFunctionFor$$(e))],!1)}function createViewStackProcessor(e,t){var r=[];return!t&&e.name&&r.push(_typescript.default.factory.createStringLiteral(e.name.getText())),_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.VIEW_STACK_PROCESSOR),_typescript.default.factory.createIdentifier(_pre_define.VISUAL_STATE)),void 0,r))}function traverseStateStylesAttr(r,n,a,o){var i=this;r.arguments[0].properties.reverse().forEach(function(e){var t;_newArrowCheck(this,i),_typescript.default.isPropertyAccessExpression(e.initializer)&&e.initializer.expression.getText()===_pre_define.THIS&&_component_map.INNER_STYLE_FUNCTION.get(e.initializer.name.getText())?(t=e.initializer.name.getText(),bindComponentAttr(_component_map.INNER_STYLE_FUNCTION.get(t).statements[0],a,n,o,!1,!0)):_typescript.default.isIdentifier(e.initializer)&&_component_map.GLOBAL_STYLE_FUNCTION.get(e.initializer.getText())?(t=e.initializer.getText(),bindComponentAttr(_component_map.GLOBAL_STYLE_FUNCTION.get(t).statements[0],a,n,o,!1,!0)):_typescript.default.isObjectLiteralExpression(e.initializer)&&1===e.initializer.properties.length&&_typescript.default.isPropertyAssignment(e.initializer.properties[0])?bindComponentAttr(_typescript.default.factory.createExpressionStatement(e.initializer.properties[0].initializer),a,n,o,!1,!0):validateStateStyleSyntax(r,o),e.name&&n.push(createViewStackProcessor(e,!1))}.bind(this))}function isExtendFunctionNode(e,t){var r=this;if(e&&_component_map.EXTEND_ATTRIBUTE.has(e.escapedText.toString())&&_toConsumableArray(_component_map.EXTEND_ATTRIBUTE.get(e.escapedText.toString())).map(function(e){return _newArrowCheck(this,r),e.attribute}.bind(this)).includes(t))return!0;return!1}exports.appComponentCollection=appComponentCollection;var ComponentType,gestureMap=new Map([[_pre_define.PRIORITY_GESTURE_ATTRIBUTE,_pre_define.GESTURE_ENUM_VALUE_HIGH],[_pre_define.PARALLEL_GESTURE_ATTRIBUTE,_pre_define.GESTURE_ENUM_VALUE_PARALLEL],[_pre_define.GESTURE_ATTRIBUTE,_pre_define.GESTURE_ENUM_VALUE_LOW]]);function parseGesture(e,t,r,n){r.push(_typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_GESTURE),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_POP_FUNCTION),null))),parseGestureInterface(e,r,n);t=_typescript.default.factory.createNodeArray([_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.GESTURE_ENUM_KEY),_typescript.default.factory.createIdentifier(gestureMap.get(t)))]);e.arguments&&1<e.arguments.length&&_typescript.default.isPropertyAccessExpression(e.arguments[1])&&t.push(e.arguments[1]),r.push(_typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_GESTURE),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_FUNCTION),t)))}function processGestureType(e,t,r){for(var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],a=[],o=_typescript.default.factory.createExpressionStatement(e),i=e.expression;i&&!_typescript.default.isIdentifier(i)&&i.expression;)i=i.expression;i&&i.parent&&_typescript.default.isCallExpression(i.parent)&&_typescript.default.isIdentifier(i)&&_component_map.GESTURE_TYPE_NAMES.has(i.escapedText.toString())&&(a.push(_typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(i,_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_POP_FUNCTION),null))),i.escapedText.toString()===_pre_define.COMPONENT_GESTURE_GROUP?(parseGestureInterface(i.parent,e=[],r,!0),a.push.apply(a,_toConsumableArray(e.reverse())),bindComponentAttr(o,i,a,r,!1),e=null,i.parent.arguments&&i.parent.arguments.length&&(e=_typescript.default.factory.createNodeArray([i.parent.arguments[0]])),a.push(_typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(i,_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_FUNCTION),e)))):(bindComponentAttr(o,i,a,r,!1),a.push(_typescript.default.factory.createExpressionStatement((0,_utils.createFunction)(i,_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_FUNCTION),i.parent.arguments))))),a.length&&(n?t.push.apply(t,_toConsumableArray(a.reverse())):t.push.apply(t,a))}function parseGestureInterface(e,t,r){var n=this,a=3<arguments.length&&void 0!==arguments[3]&&arguments[3];e.arguments&&e.arguments.length&&e.arguments.forEach(function(e){_newArrowCheck(this,n),_typescript.default.isCallExpression(e)&&processGestureType(e,t,r,a)}.bind(this))}function getName(e){for(var t,r=e.expression;r;){if(_typescript.default.isIdentifier(r)&&r.parent&&_typescript.default.isCallExpression(r.parent)){t=r.escapedText.toString();break}if(_typescript.default.isPropertyAccessExpression(r)&&r.name&&_typescript.default.isIdentifier(r.name)&&!_component_map.BUILDIN_STYLE_NAMES.has(r.name.escapedText.toString())){t=r.name.escapedText.toString();break}r=r.expression}return t}function isAttributeNode(e){for(var t,r=e.expression;r;){if(_typescript.default.isCallExpression(r)&&r.expression&&_typescript.default.isIdentifier(r.expression)){t=r.expression.escapedText.toString();break}r=r.expression}return _component_map.BUILDIN_STYLE_NAMES.has(t)}function validateFirstNode(e){var t=_validate_ui_syntax.componentCollection.entryComponent===_validate_ui_syntax.componentCollection.currentClassName;return!!(t&&validateEntryComponent(e)||!t&&validateCustomComponent(e))}function validateEntryComponent(e){return!(!_typescript.default.isExpressionStatement(e)||!_component_map.BUILDIN_CONTAINER_COMPONENT.has(getName(e)))}function validateCustomComponent(e){return!!(_typescript.default.isIfStatement(e)||_typescript.default.isExpressionStatement(e)&&(_component_map.INNER_COMPONENT_NAMES.has(getName(e))||_validate_ui_syntax.componentCollection.customComponents.has(getName(e))))}function validateBlockNode(e){return!!_typescript.default.isBlock(e)}function validateSecondNode(e){return!(!_typescript.default.isExpressionStatement(e)||!isAttributeNode(e))}function getComponentType(e,t,r){return _component_map.INNER_COMPONENT_NAMES.has(r)?ComponentType.innerComponent:_validate_ui_syntax.componentCollection.customComponents.has(r)?ComponentType.customComponent:r===_pre_define.COMPONENT_FOREACH||r===_pre_define.COMPONENT_LAZYFOREACH?(appComponentCollection.add(r),ComponentType.forEachComponent):_component_map.CUSTOM_BUILDER_METHOD.has(r)?ComponentType.customBuilderMethod:(isAttributeNode(e)||t.push({type:_utils.LogType.ERROR,message:"'".concat(e.getText(),"' does not meet UI component syntax."),pos:e.getStart()}),null)}function validateExtendParameterCount(e,t,r,n){var a=this,t=_toConsumableArray(_component_map.EXTEND_ATTRIBUTE.get(t.escapedText.toString())).filter(function(e){return _newArrowCheck(this,a),e.attribute===r}.bind(this))[0].parameterCount;e.arguments&&e.arguments.length!==t&&n.push({type:_utils.LogType.ERROR,message:"The '".concat(r,"' is expected ").concat(t," arguments, but got ").concat(e.arguments.length,"."),pos:e.getStart()})}function validateStateStyleSyntax(e,t){t.push({type:_utils.LogType.ERROR,message:".stateStyles doesn't conform standard.",pos:e.getStart()})}!function(e){e[e.innerComponent=0]="innerComponent",e[e.customComponent=1]="customComponent",e[e.forEachComponent=2]="forEachComponent",e[e.customBuilderMethod=3]="customBuilderMethod"}(ComponentType=ComponentType||{});